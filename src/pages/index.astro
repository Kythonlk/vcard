---
import MainLayout from '../layouts/main.astro';
import { XataClient } from '../xata';
 
const xata = new XataClient({
  apiKey: import.meta.env.XATA_API_KEY,
  branch: import.meta.env.XATA_BRANCH
});
 
const search = Astro.url.searchParams.get('q')! || '';
 
let users = null;
if (search) {
  users = await xata.db.Users.search(search, { fuzziness: 2 });
} else {
  users = await xata.db.Users.getAll();
}
---
 
<MainLayout title="Create your vcard now">

	<div class="w-full max-w-5xl mt-16">
		<form action="/">
			<input
			name="q"
			value={search}
			placeholder="Search..."
			class="w-full rounded-lg border-2 p-2 dark:text-purple-950"
			/>
		</form>
	</div>

  <div class="w-full max-w-5xl mt-16">
    {users.length === 0 && <p>No Users found</p>}
    {users.map((users) => (
      <div class="mb-16">
        <p class="text-xs mb-2 text-purple-950 dark:text-purple-200">
          {users.name}
        </p>
        <h2 class="text-2xl mb-2">
          <a href={`/${users.id}`}>{users.name}</a>
        </h2>
        <p class="text-purple-950 dark:text-purple-200 mb-5">
          {users.bio}
        </p>
        <a
          href={`/${users.id}`}
          class="px-4 py-2 font-semibold text-sm bg-purple-700 text-white rounded-lg shadow-sm w-fit"
        >
          Read more &rarr;
        </a>
      </div>
    ))}
  </div>
  <script type="module" src="./comonents/usercreate.ts"></script>
  <!-- <UserForm client:load /> -->
 
</MainLayout>